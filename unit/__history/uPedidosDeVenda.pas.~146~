unit uPedidosDeVenda;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtCtrls, Vcl.Buttons,
  Vcl.Grids, Vcl.DBGrids, Data.DB, Vcl.Mask, Vcl.DBCtrls;

type
  TfrmPedidosDeVenda = class(TForm)
    edtBuscar: TEdit;
    Label1: TLabel;
    DBGridVendas: TDBGrid;
    btnNovo: TSpeedButton;
    btnEditar: TSpeedButton;
    btnImprimir: TSpeedButton;
    Panel1: TPanel;
    Panel2: TPanel;
    btnSair: TSpeedButton;
    DSvendas: TDataSource;
    DSclientes: TDataSource;
    DSprodutos: TDataSource;
    Label2: TLabel;
    Label3: TLabel;
    DSitem: TDataSource;
    DBGridProdutos: TDBGrid;
    DBEdtNome: TDBEdit;
    DBEdtCpf: TDBEdit;
    procedure edtBuscarChange(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure DBGridVendasCellClick(Column: TColumn);
    procedure btnNovoClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmPedidosDeVenda: TfrmPedidosDeVenda;

implementation

{$R *.dfm}

uses uCadastrarCliente, uCadastrarProduto, uCadastrarVenda, uDataModule,
  uFunctions, uMain;

procedure TfrmPedidosDeVenda.btnNovoClick(Sender: TObject);
begin
  Application.CreateForm(TfrmCadastrarVenda, frmCadastrarVenda);
  try
    frmCadastrarVenda.ShowModal;
  finally
    FreeAndNil(frmCadastrarVenda);
  end;

end;

procedure TfrmPedidosDeVenda.DBGridVendasCellClick(Column: TColumn);
begin
  selectItemFromVenda;
  DBGridProdutos.DataSource := DSitem;
end;

procedure TfrmPedidosDeVenda.edtBuscarChange(Sender: TObject);
begin
  DM.CDSclientes.Close;
  DM.queryClientes.Close;
  DM.queryClientes.SQL.Clear;
  DM.queryClientes.SQL.Add('select * from cliente where nome LIKE "%' +
    LowerCase(Trim(edtBuscar.Text)) + '%";');
  DM.CDSclientes.Open;

  DM.CDSvendas.Close;
  DM.queryVendas.Close;
  DM.queryVendas.SQL.Clear;
  DM.queryVendas.SQL.Add('select * from venda where fkCliente =' +
    dm.CDSclientesid + ';');
  DM.CDSvendas.Open;

end;

procedure TfrmPedidosDeVenda.FormCreate(Sender: TObject);
begin
  DBEdtNome.Clear;
  DBEdtCpf.Clear;
  selectItemFromVenda;
  DBGridProdutos.DataSource := DSitem;
end;

end.
